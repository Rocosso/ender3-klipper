#!/bin/bash

set -e  # Salir si hay un error

echo "ğŸ”„ Actualizando el sistema..."
sudo apt update
sudo apt upgrade -y

# Lista de paquetes esenciales
PACKAGES=("git" "locales" "policykit-1")

echo "ğŸ“¦ Verificando e instalando paquetes necesarios..."
for pkg in "${PACKAGES[@]}"; do
    if ! dpkg -s "$pkg" &>/dev/null; then
        echo "ğŸ”§ Instalando $pkg..."
        sudo apt install -y "$pkg"
    else
        echo "âœ… $pkg ya estÃ¡ instalado."
    fi
done

echo "ğŸŒ Configurando locales..."
sudo update-locale LANG=en_US.UTF-8 LC_ALL=en_US.UTF-8
sudo locale-gen en_US.UTF-8

echo "ğŸ” Verificando instalaciÃ³n de KIAUH..."
if [ -d "$HOME/kiauh" ]; then
    echo "âœ… KIAUH ya estÃ¡ instalado en ~/kiauh."
else
    echo "â¬‡ï¸ Clonando KIAUH..."
    git clone https://github.com/dw-0/kiauh.git ~/kiauh
fi

echo "ğŸš€ Iniciando instalador de KIAUH..."
bash ~/kiauh/kiauh.sh

echo "ğŸ“ Verificando archivos de configuraciÃ³n personalizados..."
if [ ! -d "$HOME/ender3-klipper" ]; then
    git clone https://github.com/Rocosso/ender3-klipper.git ~/ender3-klipper
fi

echo "ğŸ“‚ Copiando archivos de configuraciÃ³n a printer_data/config/"
cp -r ~/ender3-klipper/* ~/printer_data/config/

echo "âœ… InstalaciÃ³n y configuraciÃ³n completada."

